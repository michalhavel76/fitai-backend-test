// ============================================
// FitAI 4.4 ‚Äì NeverZero + Legal Trace Engine
// ============================================

generator client {
  provider = "prisma-client-js"
}

// üîó Datasource: hlavn√≠ Railway DB + lok√°ln√≠ shadow (SQLite)
datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

// ============================================
// ü•ó Main Table ‚Äì Foods
// ============================================
model foods {
  id                  Int       @id @default(autoincrement())
  name_en             String?   @unique(map: "unique_name_en")
  name_cz             String?
  category            String?
  origin              String?
  kcal                Float?
  protein             Float?
  carbs               Float?
  fat                 Float?
  fiber               Float?
  sugar               Float?
  sodium              Float?
  vitamin_a           Float?
  vitamin_c           Float?
  calcium             Float?
  iron                Float?
  source              String?
  image_url           String?
  lang                Json?
  created_at          DateTime? @default(now())
  accuracy_score      Float?    @default(0.0)
  alcohol             Float?
  biotin_b7           Float?
  caffeine            Float?
  cholesterol         Float?
  choline             Float?
  chromium            Float?
  composition         Json?
  copper              Float?
  dish_name           String?
  folate_b9           Float?
  iodine              Float?
  is_global           Boolean?  @default(false)
  magnesium           Float?
  manganese           Float?
  molybdenum          Float?
  monounsaturated_fat Float?
  niacin_b3           Float?
  omega_3             Float?
  omega_6             Float?
  pantothenic_b5      Float?
  phosphorus          Float?
  polyunsaturated_fat Float?
  potassium           Float?
  region              String?   @default("global")
  riboflavin_b2       Float?
  selenium            Float?
  thiamin_b1          Float?
  trans_fat           Float?
  vitamin_b12         Float?
  vitamin_b6          Float?
  vitamin_d           Float?
  vitamin_e           Float?
  vitamin_k           Float?
  water               Float?
  zinc                Float?
  updated_at          DateTime? @default(now()) @db.Timestamp(6)

  // üîó Relation ‚Äì audit log
  audit_logs food_audit_log[]
}

// ============================================
// üìä Global Reference Data ‚Äì FitAI DataHub
// ============================================
model FitAI_DataHub {
  id             Int       @id @default(autoincrement())
  nutrient_key   String    @unique
  avg_value      Float
  region         String?   @default("global")
  samples_count  Int?      @default(0)
  accuracy_score Float?    @default(0.85)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @default(now()) @updatedAt @db.Timestamp(6)
}

// ============================================
// ‚öñÔ∏è Legal Trace ‚Äì Food Audit Log
// ============================================
model food_audit_log {
  id                Int       @id @default(autoincrement())
  food_id           Int
  changed_fields    Json
  source_chain      Json
  reliability_score Float
  timestamp         DateTime  @default(now())

  // üîó Relation ‚Äì back to foods
  food foods @relation(fields: [food_id], references: [id], onDelete: Cascade)
}
